<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.mapper.HeadlineMapper">
  <resultMap id="BaseResultMap" type="com.example.entity.Headline">
    <id property="hid" column="hid" jdbcType="INTEGER"/>
    <result property="title" column="title" jdbcType="VARCHAR"/>
    <result property="article" column="article" jdbcType="VARCHAR"/>
    <result property="type" column="type" jdbcType="INTEGER"/>
    <result property="publisher" column="publisher" jdbcType="INTEGER"/>
    <result property="pageViews" column="page_views" jdbcType="INTEGER"/>
    <result property="createTime" column="create_time" jdbcType="TIMESTAMP"/>
    <result property="updateTime" column="update_time" jdbcType="TIMESTAMP"/>
    <result property="version" column="version" jdbcType="INTEGER"/>
    <result property="isDeleted" column="is_deleted" jdbcType="INTEGER"/>
  </resultMap>

  <select id="selectPageMap" resultType="map">
    select hid, title, type, page_views pageViews, timestampdiff(hour, create_time, now()) pastHours,
    publisher from headlines where is_deleted = 0
    <if test="portalVO.keywords != null and portalVO.keywords != ''">
      and title like concat('%', #{portalVO.keywords}, '%')
    </if>
    <if test="portalVO.type != null and portalVO.type != 0">
      and type = #{portalVO.type}
    </if>
  </select>

  <select id="selectDetailMap" resultType="map">
    select hid, title, article, type, h.version, tname typeName, page_views pageViews,
    timestampdiff(hour, create_time, now()) pastHours, publisher, nick_name author
    from headlines h left join headline_types t on h.type = t.tid
    left join users u on h.publisher = u.uid where h.is_deleted = 0 and h.hid = #{hid}
  </select>
</mapper>
