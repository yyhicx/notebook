<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.mapper.UserMapper">

  <resultMap id="UserResultMap" type="com.example.entity.User">
    <id property="id" column="id"/>
    <result property="username" column="username"/>
    <result property="password" column="password"/>
    <result property="email" column="email"/>
    <result property="phone" column="phone"/>
    <result property="status" column="status"/>
    <result property="createdTime" column="created_time"/>
    <result property="updatedTime" column="updated_time"/>
    <result property="isDeleted" column="is_deleted"/>
  </resultMap>

  <insert id="createUser" useGeneratedKeys="true" keyProperty="id" keyColumn="id">
    insert into user_info (username, password, email, phone, status, created_time, updated_time,
                           is_deleted)
    values (#{username}, #{password}, #{email}, #{phone}, #{status}, #{createdTime}, #{updatedTime},
            #{isDeleted})
  </insert>

  <update id="updateUser" parameterType="User">
    update user_info
    set username     = #{username},
        password     = #{password},
        email        = #{email},
        phone        = #{phone},
        status       = #{status},
        updated_time = #{updatedTime}
    where id = #{id}
  </update>

  <update id="deleteUserById">
    update user_info
    set is_deleted= true
    where id = #{id}
  </update>

  <select id="getAllUsers" resultMap="UserResultMap">
    select *
    from user_info
    where is_deleted = false
    order by created_time desc
  </select>

  <select id="getUserById" resultMap="UserResultMap">
    select *
    from user_info
    where id = #{id}
      and is_deleted = false
  </select>

  <select id="getUserByUsername" resultMap="UserResultMap">
    select *
    from user_info
    where username = #{username}
      and is_deleted = false
  </select>

  <select id="getUserByEmail" resultMap="UserResultMap">
    select *
    from user_info
    where email = #{email}
      and is_deleted = false
  </select>

  <select id="existsByUsername" resultType="boolean">
    select count(*) > 0
    from user_info
    where username = #{username}
      and is_deleted = false
  </select>

  <select id="existsByEmail" resultType="boolean">
    select count(*) > 0
    from user_info
    where email = #{email}
      and is_deleted = false
  </select>

</mapper>
